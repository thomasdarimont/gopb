<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat</title>
    <style>
        input {
            display: block;
        }

        ul {
            list-style: none;
        }
    </style>
</head>
<body>
<h1>Chat</h1>
<ul id="messages"></ul>
<form id="chatbox">
    {{.UserData.name}}:<br/>
    <textarea></textarea>
    <input type="submit" value="Send">
</form>
</body>
<script>

    let msgBox = document.querySelector("#chatbox textarea");
    let messages = document.querySelector("#messages");
    let chatbox = document.querySelector("#chatbox");

    chatbox.onsubmit = () => {
        if (!msgBox.value) {
            return false;
        }
        if (!socket) {
            alert("Error there is no socket connection!");
            return false;
        }

        socket.send(JSON.stringify({"Message": msgBox.value}));
        msgBox.value = "";
        return false;
    };

    if ("WebSocket" in window) {

        socket = new WebSocket("ws://{{.Host}}/room");
        socket.onclose = () => alert("Connection has been closed.");
        socket.onmessage = (e) => {

            msg = JSON.parse(e.data);

            let li = document.createElement("li");
            let name = document.createElement("strong");
            let message = document.createElement("span");

            name.textContent = msg.Name + ": ";
            message.textContent = msg.Message;

            li.appendChild(name);
            li.appendChild(message);

            messages.append(li);
        };

    } else {
        alert("Error: Your Browser doesn't support web sockets!")
    }

</script>
</html>